(()=>{"use strict";function t(t,r,n,e,i){if(isNaN(r)||isNaN(n)||isNaN(e))return t;var u,o,s,a,c,h,l,f,p,y,d,_,x=t._root,g={data:i},v=t._x0,w=t._y0,z=t._z0,b=t._x1,m=t._y1,A=t._z1;if(!x)return t._root=g,t;for(;x.length;)if((f=r>=(o=(v+b)/2))?v=o:b=o,(p=n>=(s=(w+m)/2))?w=s:m=s,(y=e>=(a=(z+A)/2))?z=a:A=a,u=x,!(x=x[d=y<<2|p<<1|f]))return u[d]=g,t;if(c=+t._x.call(null,x.data),h=+t._y.call(null,x.data),l=+t._z.call(null,x.data),r===c&&n===h&&e===l)return g.next=x,u?u[d]=g:t._root=g,t;do{u=u?u[d]=new Array(8):t._root=new Array(8),(f=r>=(o=(v+b)/2))?v=o:b=o,(p=n>=(s=(w+m)/2))?w=s:m=s,(y=e>=(a=(z+A)/2))?z=a:A=a}while((d=y<<2|p<<1|f)==(_=(l>=a)<<2|(h>=s)<<1|c>=o));return u[_]=x,u[d]=g,t}function r(t,r,n,e,i,u,o){this.node=t,this.x0=r,this.y0=n,this.z0=e,this.x1=i,this.y1=u,this.z1=o}function n(t){return t[0]}function e(t){return t[1]}function i(t){return t[2]}function u(t,r,u,s){var a=new o(null==r?n:r,null==u?e:u,null==s?i:s,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?a:a.addAll(t)}function o(t,r,n,e,i,u,o,s,a){this._x=t,this._y=r,this._z=n,this._x0=e,this._y0=i,this._z0=u,this._x1=o,this._y1=s,this._z1=a,this._root=void 0}function s(t){for(var r={data:t.data},n=r;t=t.next;)n=n.next={data:t.data};return r}var a=u.prototype=o.prototype;function c(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function h(t){return function r(n){return 0===arguments.length||c(n)?r:t.apply(this,arguments)}}function l(t){return function r(n,e){switch(arguments.length){case 0:return r;case 1:return c(n)?r:h((function(r){return t(n,r)}));default:return c(n)&&c(e)?r:c(n)?h((function(r){return t(r,e)})):c(e)?h((function(r){return t(n,r)})):t(n,e)}}}a.copy=function(){var t,r,n=new o(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root;if(!e)return n;if(!e.length)return n._root=s(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var i=0;i<8;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(8)}):e.target[i]=s(r));return n},a.add=function(r){var n=+this._x.call(null,r),e=+this._y.call(null,r),i=+this._z.call(null,r);return t(this.cover(n,e,i),n,e,i,r)},a.addAll=function(r){var n,e,i,u,o,s=r.length,a=new Array(s),c=new Array(s),h=new Array(s),l=1/0,f=1/0,p=1/0,y=-1/0,d=-1/0,_=-1/0;for(e=0;e<s;++e)isNaN(i=+this._x.call(null,n=r[e]))||isNaN(u=+this._y.call(null,n))||isNaN(o=+this._z.call(null,n))||(a[e]=i,c[e]=u,h[e]=o,i<l&&(l=i),i>y&&(y=i),u<f&&(f=u),u>d&&(d=u),o<p&&(p=o),o>_&&(_=o));for(y<l&&(l=this._x0,y=this._x1),d<f&&(f=this._y0,d=this._y1),_<p&&(p=this._z0,_=this._z1),this.cover(l,f,p).cover(y,d,_),e=0;e<s;++e)t(this,a[e],c[e],h[e],r[e]);return this},a.cover=function(t,r,n){if(isNaN(t=+t)||isNaN(r=+r)||isNaN(n=+n))return this;var e=this._x0,i=this._y0,u=this._z0,o=this._x1,s=this._y1,a=this._z1;if(isNaN(e))o=(e=Math.floor(t))+1,s=(i=Math.floor(r))+1,a=(u=Math.floor(n))+1;else{if(!(e>t||t>o||i>r||r>s||u>n||n>a))return this;var c,h,l=o-e,f=this._root;switch(h=(n<(u+a)/2)<<2|(r<(i+s)/2)<<1|t<(e+o)/2){case 0:do{(c=new Array(8))[h]=f,f=c}while(s=i+(l*=2),a=u+l,t>(o=e+l)||r>s||n>a);break;case 1:do{(c=new Array(8))[h]=f,f=c}while(s=i+(l*=2),a=u+l,(e=o-l)>t||r>s||n>a);break;case 2:do{(c=new Array(8))[h]=f,f=c}while(i=s-(l*=2),a=u+l,t>(o=e+l)||i>r||n>a);break;case 3:do{(c=new Array(8))[h]=f,f=c}while(i=s-(l*=2),a=u+l,(e=o-l)>t||i>r||n>a);break;case 4:do{(c=new Array(8))[h]=f,f=c}while(s=i+(l*=2),u=a-l,t>(o=e+l)||r>s||u>n);break;case 5:do{(c=new Array(8))[h]=f,f=c}while(s=i+(l*=2),u=a-l,(e=o-l)>t||r>s||u>n);break;case 6:do{(c=new Array(8))[h]=f,f=c}while(i=s-(l*=2),u=a-l,t>(o=e+l)||i>r||u>n);break;case 7:do{(c=new Array(8))[h]=f,f=c}while(i=s-(l*=2),u=a-l,(e=o-l)>t||i>r||u>n)}this._root&&this._root.length&&(this._root=f)}return this._x0=e,this._y0=i,this._z0=u,this._x1=o,this._y1=s,this._z1=a,this},a.data=function(){var t=[];return this.visit((function(r){if(!r.length)do{t.push(r.data)}while(r=r.next)})),t},a.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},a.find=function(t,n,e,i){var u,o,s,a,c,h,l,f,p,y=this._x0,d=this._y0,_=this._z0,x=this._x1,g=this._y1,v=this._z1,w=[],z=this._root;for(z&&w.push(new r(z,y,d,_,x,g,v)),null==i?i=1/0:(y=t-i,d=n-i,_=e-i,x=t+i,g=n+i,v=e+i,i*=i);f=w.pop();)if(!(!(z=f.node)||(o=f.x0)>x||(s=f.y0)>g||(a=f.z0)>v||(c=f.x1)<y||(h=f.y1)<d||(l=f.z1)<_))if(z.length){var b=(o+c)/2,m=(s+h)/2,A=(a+l)/2;w.push(new r(z[7],b,m,A,c,h,l),new r(z[6],o,m,A,b,h,l),new r(z[5],b,s,A,c,m,l),new r(z[4],o,s,A,b,m,l),new r(z[3],b,m,a,c,h,A),new r(z[2],o,m,a,b,h,A),new r(z[1],b,s,a,c,m,A),new r(z[0],o,s,a,b,m,A)),(p=(e>=A)<<2|(n>=m)<<1|t>=b)&&(f=w[w.length-1],w[w.length-1]=w[w.length-1-p],w[w.length-1-p]=f)}else{var N=t-+this._x.call(null,z.data),j=n-+this._y.call(null,z.data),O=e-+this._z.call(null,z.data),k=N*N+j*j+O*O;if(k<i){var M=Math.sqrt(i=k);y=t-M,d=n-M,_=e-M,x=t+M,g=n+M,v=e+M,u=z.data}}return u},a.remove=function(t){if(isNaN(u=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t))||isNaN(s=+this._z.call(null,t)))return this;var r,n,e,i,u,o,s,a,c,h,l,f,p,y,d,_=this._root,x=this._x0,g=this._y0,v=this._z0,w=this._x1,z=this._y1,b=this._z1;if(!_)return this;if(_.length)for(;;){if((l=u>=(a=(x+w)/2))?x=a:w=a,(f=o>=(c=(g+z)/2))?g=c:z=c,(p=s>=(h=(v+b)/2))?v=h:b=h,r=_,!(_=_[y=p<<2|f<<1|l]))return this;if(!_.length)break;(r[y+1&7]||r[y+2&7]||r[y+3&7]||r[y+4&7]||r[y+5&7]||r[y+6&7]||r[y+7&7])&&(n=r,d=y)}for(;_.data!==t;)if(e=_,!(_=_.next))return this;return(i=_.next)&&delete _.next,e?(i?e.next=i:delete e.next,this):r?(i?r[y]=i:delete r[y],(_=r[0]||r[1]||r[2]||r[3]||r[4]||r[5]||r[6]||r[7])&&_===(r[7]||r[6]||r[5]||r[4]||r[3]||r[2]||r[1]||r[0])&&!_.length&&(n?n[d]=_:this._root=_),this):(this._root=i,this)},a.removeAll=function(t){for(var r=0,n=t.length;r<n;++r)this.remove(t[r]);return this},a.root=function(){return this._root},a.size=function(){var t=0;return this.visit((function(r){if(!r.length)do{++t}while(r=r.next)})),t},a.visit=function(t){var n,e,i,u,o,s,a,c,h=[],l=this._root;for(l&&h.push(new r(l,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=h.pop();)if(!t(l=n.node,i=n.x0,u=n.y0,o=n.z0,s=n.x1,a=n.y1,c=n.z1)&&l.length){var f=(i+s)/2,p=(u+a)/2,y=(o+c)/2;(e=l[7])&&h.push(new r(e,f,p,y,s,a,c)),(e=l[6])&&h.push(new r(e,i,p,y,f,a,c)),(e=l[5])&&h.push(new r(e,f,u,y,s,p,c)),(e=l[4])&&h.push(new r(e,i,u,y,f,p,c)),(e=l[3])&&h.push(new r(e,f,p,o,s,a,y)),(e=l[2])&&h.push(new r(e,i,p,o,f,a,y)),(e=l[1])&&h.push(new r(e,f,u,o,s,p,y)),(e=l[0])&&h.push(new r(e,i,u,o,f,p,y))}return this},a.visitAfter=function(t){var n,e=[],i=[];for(this._root&&e.push(new r(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var u=n.node;if(u.length){var o,s=n.x0,a=n.y0,c=n.z0,h=n.x1,l=n.y1,f=n.z1,p=(s+h)/2,y=(a+l)/2,d=(c+f)/2;(o=u[0])&&e.push(new r(o,s,a,c,p,y,d)),(o=u[1])&&e.push(new r(o,p,a,c,h,y,d)),(o=u[2])&&e.push(new r(o,s,y,c,p,l,d)),(o=u[3])&&e.push(new r(o,p,y,c,h,l,d)),(o=u[4])&&e.push(new r(o,s,a,d,p,y,f)),(o=u[5])&&e.push(new r(o,p,a,d,h,y,f)),(o=u[6])&&e.push(new r(o,s,y,d,p,l,f)),(o=u[7])&&e.push(new r(o,p,y,d,h,l,f))}i.push(n)}for(;n=i.pop();)t(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this},a.x=function(t){return arguments.length?(this._x=t,this):this._x},a.y=function(t){return arguments.length?(this._y=t,this):this._y},a.z=function(t){return arguments.length?(this._z=t,this):this._z};const f=Number.isInteger||function(t){return(0|t)===t},p=l((function(t,r){var n,e;if(null!=r)return f(t)?(e=r)[(n=t)<0?e.length+n:n]:r[t]})),y=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function d(t,r){return function(){var n=arguments.length;if(0===n)return r();var e=arguments[n-1];return y(e)||"function"!=typeof e[t]?r.apply(this,arguments):e[t].apply(e,Array.prototype.slice.call(arguments,0,n-1))}}function _(t){return function r(n,e,i){switch(arguments.length){case 0:return r;case 1:return c(n)?r:l((function(r,e){return t(n,r,e)}));case 2:return c(n)&&c(e)?r:c(n)?l((function(r,n){return t(r,e,n)})):c(e)?l((function(r,e){return t(n,r,e)})):h((function(r){return t(n,e,r)}));default:return c(n)&&c(e)&&c(i)?r:c(n)&&c(e)?l((function(r,n){return t(r,n,i)})):c(n)&&c(i)?l((function(r,n){return t(r,e,n)})):c(e)&&c(i)?l((function(r,e){return t(n,r,e)})):c(n)?h((function(r){return t(r,e,i)})):c(e)?h((function(r){return t(n,r,i)})):c(i)?h((function(r){return t(n,e,r)})):t(n,e,i)}}}const x=_(d("slice",(function(t,r,n){return Array.prototype.slice.call(n,t,r)}))),g=l((function(t,r){if(t<=0)throw new Error("First argument to splitEvery must be a positive integer");for(var n=[],e=0;e<r.length;)n.push(x(e,e+=t,r));return n})),v=Math.sqrt,w=t=>t*t,z=(t,r)=>v(w(t.x-r.x)+w(t.y-r.y)+w(t.z-r.z));let b=1;const m=(t,r,n)=>({id:b++,x:t,y:r,z:n}),A=Math.random,N=Math.floor,j=t=>{const r=N(A()*t.lenx),n=N(A()*t.leny),e=N(A()*t.lenz);return m(r,n,e)},O=(t,r)=>z(t.coord,r)<=t.r,k=(t,r)=>({x:t.x+r.x,y:t.y+r.y,z:t.z+r.z}),M=(t,r)=>({x:r.x*t,y:r.y*t,z:r.z*t});function S(t,r){return Object.prototype.hasOwnProperty.call(r,t)}var P=Object.prototype.toString;const E=function(){return"[object Arguments]"===P.call(arguments)?function(t){return"[object Arguments]"===P.call(t)}:function(t){return S("callee",t)}}();var F=!{toString:null}.propertyIsEnumerable("toString"),C=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],I=function(){return arguments.propertyIsEnumerable("length")}(),U=function(t,r){for(var n=0;n<t.length;){if(t[n]===r)return!0;n+=1}return!1};const R="function"!=typeof Object.keys||I?h((function(t){if(Object(t)!==t)return[];var r,n,e=[],i=I&&E(t);for(r in t)!S(r,t)||i&&"length"===r||(e[e.length]=r);if(F)for(n=C.length-1;n>=0;)S(r=C[n],t)&&!U(e,r)&&(e[e.length]=r),n-=1;return e})):h((function(t){return Object(t)!==t?[]:Object.keys(t)})),T=t=>{const r={},n=new Map,e=r=>t[r.id],i=t=>!r[t.id],u=t=>r[t.id]=!0,o=(r,n)=>{const s=t[r].neighbors.filter(i);for(const t of s)u(t);n.push(...s);const a=s.filter(e);for(const t of a)o(t.id,n)};for(const e of R(t)){const i=t[e].core;if(r[i.id])continue;u(i);const s=[i];o(e,s),n.set(i,s)}return n},$=l((function(t,r){for(var n={},e=0;e<t.length;)t[e]in r&&(n[t[e]]=r[t[e]]),e+=1;return n}))(["_x0","_y0","_z0","_x1","_y1","_z1","_root"]);function q(t,r,n){return function(){if(0===arguments.length)return n();var e=arguments[arguments.length-1];if(!y(e)){for(var i=0;i<t.length;){if("function"==typeof e[t[i]])return e[t[i]].apply(e,Array.prototype.slice.call(arguments,0,-1));i+=1}if(function(t){return null!=t&&"function"==typeof t["@@transducer/step"]}(e))return r.apply(null,Array.prototype.slice.call(arguments,0,-1))(e)}return n.apply(this,arguments)}}const B=h((function(t){return!!y(t)||!!t&&"object"==typeof t&&!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)&&(0===t.length||t.length>0&&t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1))}));function D(t,r,n){for(var e=0,i=n.length;e<i;){if((r=t["@@transducer/step"](r,n[e]))&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}e+=1}return t["@@transducer/result"](r)}var L="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function V(t,r,n){return function(e,i,u){if(B(u))return t(e,i,u);if(null==u)return i;if("function"==typeof u["fantasy-land/reduce"])return r(e,i,u,"fantasy-land/reduce");if(null!=u[L])return n(e,i,u[L]());if("function"==typeof u.next)return n(e,i,u);if("function"==typeof u.reduce)return r(e,i,u,"reduce");throw new TypeError("reduce: list must be array or iterable")}}function W(t,r){switch(t){case 0:return function(){return r.apply(this,arguments)};case 1:return function(t){return r.apply(this,arguments)};case 2:return function(t,n){return r.apply(this,arguments)};case 3:return function(t,n,e){return r.apply(this,arguments)};case 4:return function(t,n,e,i){return r.apply(this,arguments)};case 5:return function(t,n,e,i,u){return r.apply(this,arguments)};case 6:return function(t,n,e,i,u,o){return r.apply(this,arguments)};case 7:return function(t,n,e,i,u,o,s){return r.apply(this,arguments)};case 8:return function(t,n,e,i,u,o,s,a){return r.apply(this,arguments)};case 9:return function(t,n,e,i,u,o,s,a,c){return r.apply(this,arguments)};case 10:return function(t,n,e,i,u,o,s,a,c,h){return r.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}const X=l((function(t,r){return W(t.length,(function(){return t.apply(r,arguments)}))}));function G(t,r,n){for(var e=n.next();!e.done;){if((r=t["@@transducer/step"](r,e.value))&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}e=n.next()}return t["@@transducer/result"](r)}function H(t,r,n,e){return t["@@transducer/result"](n[e](X(t["@@transducer/step"],t),r))}const J=V(D,H,G),K=function(){return this.xf["@@transducer/init"]()},Q=function(t){return this.xf["@@transducer/result"](t)};var Y="@@transducer/init",Z="@@transducer/step",tt="@@transducer/result",rt=function(){function t(t){this.xf=t}return t.prototype[Y]=K,t.prototype[tt]=Q,t.prototype[Z]=function(t,r){var n=this.xf[Z](t,r);return n["@@transducer/reduced"]?{"@@transducer/value":n,"@@transducer/reduced":!0}:n},t}(),nt=function(){function t(t){this.xf=new rt(t)}return t.prototype[Y]=K,t.prototype[tt]=Q,t.prototype[Z]=function(t,r){return B(r)?J(this.xf,t,r):D(this.xf,t,[r])},t}();var et=function(){function t(t,r){this.xf=r,this.f=t}return t.prototype["@@transducer/init"]=K,t.prototype["@@transducer/result"]=Q,t.prototype["@@transducer/step"]=function(t,r){return this.xf["@@transducer/step"](t,this.f(r))},t}();const it=function(t){return function(r){return new et(t,r)}};function ut(t){return function(r){return it(t)(function(t){return new nt(t)}(r))}}function ot(t,r,n){return function(){for(var e=[],i=0,u=t,o=0,s=!1;o<r.length||i<arguments.length;){var a;o<r.length&&(!c(r[o])||i>=arguments.length)?a=r[o]:(a=arguments[i],i+=1),e[o]=a,c(a)?s=!0:u-=1,o+=1}return!s&&u<=0?n.apply(this,e):W(Math.max(0,u),ot(t,e,n))}}const st=l((function(t,r){return 1===t?h(r):W(t,ot(t,[],r))})),at=l(q(["fantasy-land/map","map"],it,(function(t,r){switch(Object.prototype.toString.call(r)){case"[object Function]":return st(r.length,(function(){return t.call(this,r.apply(this,arguments))}));case"[object Object]":return function(t,r,n){for(var e=0,i=n.length;e<i;)r=t(r,n[e]),e+=1;return r}((function(n,e){return n[e]=t(r[e]),n}),{},R(r));default:return function(t,r){for(var n=0,e=r.length,i=Array(e);n<e;)i[n]=t(r[n]),n+=1;return i}(t,r)}}))),ct=l(q(["fantasy-land/chain","chain"],ut,(function(t,r){return"function"==typeof r?function(n){return t(r(n))(n)}:function(t){for(var r,n,e,i=[],u=0,o=t.length;u<o;){if(B(t[u]))for(e=0,n=(r=t[u]).length;e<n;)i[i.length]=r[e],e+=1;else i[i.length]=t[u];u+=1}return i}(at(t,r))}))),ht=h((function(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}));function lt(t,r,n){if(n||(n=new ft),i=typeof(e=t),null==e||"object"!=i&&"function"!=i)return t;var e,i,u,o=function(e){var i=n.get(t);if(i)return i;for(var u in n.set(t,e),t)Object.prototype.hasOwnProperty.call(t,u)&&(e[u]=r?lt(t[u],!0,n):t[u]);return e};switch(ht(t)){case"Object":return o(Object.create(Object.getPrototypeOf(t)));case"Array":return o(Array(t.length));case"Date":return new Date(t.valueOf());case"RegExp":return u=t,new RegExp(u.source,u.flags?u.flags:(u.global?"g":"")+(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.sticky?"y":"")+(u.unicode?"u":"")+(u.dotAll?"s":""));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return t.slice();default:return t}}var ft=function(){function t(){this.map={},this.length=0}return t.prototype.set=function(t,r){var n=this.hash(t),e=this.map[n];e||(this.map[n]=e=[]),e.push([t,r]),this.length+=1},t.prototype.hash=function(t){var r=[];for(var n in t)r.push(Object.prototype.toString.call(t[n]));return r.join()},t.prototype.get=function(t){if(this.length<=180){for(var r in this.map)for(var n=this.map[r],e=0;e<n.length;e+=1)if((u=n[e])[0]===t)return u[1]}else{var i=this.hash(t);if(n=this.map[i])for(e=0;e<n.length;e+=1){var u;if((u=n[e])[0]===t)return u[1]}}},t}(),pt=function(){function t(t,r,n,e){this.valueFn=t,this.valueAcc=r,this.keyFn=n,this.xf=e,this.inputs={}}return t.prototype["@@transducer/init"]=K,t.prototype["@@transducer/result"]=function(t){var r;for(r in this.inputs)if(S(r,this.inputs)&&(t=this.xf["@@transducer/step"](t,this.inputs[r]))["@@transducer/reduced"]){t=t["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](t)},t.prototype["@@transducer/step"]=function(t,r){var n=this.keyFn(r);return this.inputs[n]=this.inputs[n]||[n,lt(this.valueAcc,!1)],this.inputs[n][1]=this.valueFn(this.inputs[n][1],r),t},t}();function yt(t,r,n){return function(e){return new pt(t,r,n,e)}}var dt=function(){function t(t){this.f=t}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(t){return t},t.prototype["@@transducer/step"]=function(t,r){return this.f(t,r)},t}();const _t=ot(4,[],q([],yt,(function(t,r,n,e){var i=new dt((function(e,i){var u,o=n(i),s=t(S(o,e)?e[o]:lt(r,!1),i);return s&&s["@@transducer/reduced"]?(u=e)&&u["@@transducer/reduced"]?u:{"@@transducer/value":u,"@@transducer/reduced":!0}:(e[o]=s,e)}));return J(i,{},e)})))((function(t,r){return r}),null),xt=t=>`${t.x}-${t.y}-${t.z}`;self.onmessage=({data:t})=>{const r={lenx:t.lenx,leny:t.leny,lenz:t.lenz},n=t.size,e=t.maxTry,i=t.eps,o=t.k,s=(t=>{const{sphereRadii:r,space:n,maxCount:e,maxTryCount:i}=t,u=[];let o=0;for(;(!e||u.length<=e-1)&&o<=i;){const t={coord:j(n),r:(s=void 0,(s=r)[Math.floor(Math.random()*s.length)])};u.some((r=>{return e=r,z((n=t).coord,e.coord)<n.r+e.r;var n,e}))?o++:(u.push(t),o=0)}var s;return u})({space:r,sphereRadii:[n],maxTryCount:e,maxCount:t.maxCount}),a=(({gridStep:t,space:r})=>{const n=Math.floor(r.lenx/t),e=Math.floor(r.leny/t),i=Math.floor(r.lenz/t),u=[];for(let r=0;r<i;r++)for(let i=0;i<e;i++)for(let e=0;e<n;e++)u.push(m(e*t,i*t,r*t));return u})({gridStep:t.step,space:r}),c=(({points:t,spheres:r})=>{const n=u(t,p("x"),p("y"),p("z")),e=ct((t=>(({tree:t,eps:r,point:n})=>{const e=[];return t.visit(((t,i,u,o,s,a,c)=>{if(!((t,r,n,e)=>{const i=.5*(r.x-t.x),u=M(.5,k(t,r)),o=M(-1,u),s=k(e,o),a={x:["y","z"],y:["x","z"],z:["x","y"]},c=["x","y","z"].some((t=>s[t]>=-i-n&&s[t]<=i+n&&a[t].every((t=>s[t]>=-i&&s[t]<=i)))),h=[{x:i,y:i,z:i},{x:i,y:i,z:-i},{x:i,y:-i,z:i},{x:-i,y:i,z:i},{x:-i,y:-i,z:i},{x:i,y:-i,z:-i},{x:-i,y:i,z:-i},{x:-i,y:-i,z:-i}].some((t=>O({coord:s,r:n},t)));return c||h})({x:i,y:u,z:o},{x:s,y:a,z:c},r,n))return!0;if((t=>!t.length)(t)){let i=t.data;do{l=n,(h=i).x===l.x&&h.y===l.y&&h.z===l.z||!O({coord:n,r},i)||e.push(i)}while(i=t.next&&t.next.data)}var h,l})),e})({tree:n,eps:t.r,point:t.coord})),r),i=_t(xt,e);return t.filter((t=>!i[xt(t)]))})({spheres:s,points:a}),h=u(c,p("x"),p("y"),p("z")),l=navigator.hardwareConcurrency||4,f=Math.ceil(c.length/l),y=g(f,c);Promise.all(y.map((t=>new Promise((r=>{const n=new Worker("/assets/workers/dbscan-core-finder.js");n.postMessage({eps:i,minPoints:o,points:t,tree:$(h)}),n.addEventListener("message",(t=>r(t.data)))}))))).then((t=>t.reduce(((t,r)=>({...t,...r})),{}))).then(T).then((r=>postMessage({clusters:r,spheres:s,numberOfPoints:a.length,numberOfVoidPoints:c.length,spaceVolume:t.lenx*t.leny*t.lenz},void 0)))}})();
//# sourceMappingURL=dbscan.js.map