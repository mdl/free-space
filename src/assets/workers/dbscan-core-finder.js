(()=>{"use strict";const t=Math.sqrt,n=t=>t*t,i=(Math.random,Math.floor,(i,r)=>{return e=i.coord,s=r,t(n(e.x-s.x)+n(e.y-s.y)+n(e.z-s.z))<=i.r;var e,s}),r=(t,n)=>({x:t.x+n.x,y:t.y+n.y,z:t.z+n.z}),e=(t,n)=>({x:n.x*t,y:n.y*t,z:n.z*t}),s=({tree:t,eps:n,point:s})=>{const h=[];return t.visit(((t,o,a,u,l,_,c)=>{if(!((t,n,s,h)=>{const o=.5*(n.x-t.x),a=e(.5,r(t,n)),u=e(-1,a),l=r(h,u),_={x:["y","z"],y:["x","z"],z:["x","y"]},c=["x","y","z"].some((t=>l[t]>=-o-s&&l[t]<=o+s&&_[t].every((t=>l[t]>=-o&&l[t]<=o)))),y=[{x:o,y:o,z:o},{x:o,y:o,z:-o},{x:o,y:-o,z:o},{x:-o,y:o,z:o},{x:-o,y:-o,z:o},{x:o,y:-o,z:-o},{x:-o,y:o,z:-o},{x:-o,y:-o,z:-o}].some((t=>i({coord:l,r:s},t)));return c||y})({x:o,y:a,z:u},{x:l,y:_,z:c},n,s))return!0;if((t=>!t.length)(t)){let r=t.data;do{f=s,(y=r).x===f.x&&y.y===f.y&&y.z===f.z||!i({coord:s,r:n},r)||h.push(r)}while(r=t.next&&t.next.data)}var y,f})),h};function h(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function o(t){return function n(i){return 0===arguments.length||h(i)?n:t.apply(this,arguments)}}function a(t){return function n(i,r){switch(arguments.length){case 0:return n;case 1:return h(i)?n:o((function(n){return t(i,n)}));default:return h(i)&&h(r)?n:h(i)?o((function(n){return t(n,r)})):h(r)?o((function(n){return t(i,n)})):t(i,r)}}}function u(t,n,i,r,e){if(isNaN(n)||isNaN(i)||isNaN(r))return t;var s,h,o,a,u,l,_,c,y,f,x,z,w=t._root,d={data:e},p=t._x0,v=t._y0,N=t._z0,g=t._x1,A=t._y1,b=t._z1;if(!w)return t._root=d,t;for(;w.length;)if((c=n>=(h=(p+g)/2))?p=h:g=h,(y=i>=(o=(v+A)/2))?v=o:A=o,(f=r>=(a=(N+b)/2))?N=a:b=a,s=w,!(w=w[x=f<<2|y<<1|c]))return s[x]=d,t;if(u=+t._x.call(null,w.data),l=+t._y.call(null,w.data),_=+t._z.call(null,w.data),n===u&&i===l&&r===_)return d.next=w,s?s[x]=d:t._root=d,t;do{s=s?s[x]=new Array(8):t._root=new Array(8),(c=n>=(h=(p+g)/2))?p=h:g=h,(y=i>=(o=(v+A)/2))?v=o:A=o,(f=r>=(a=(N+b)/2))?N=a:b=a}while((x=f<<2|y<<1|c)==(z=(_>=a)<<2|(l>=o)<<1|u>=h));return s[z]=w,s[x]=d,t}function l(t,n,i,r,e,s,h){this.node=t,this.x0=n,this.y0=i,this.z0=r,this.x1=e,this.y1=s,this.z1=h}function _(t){return t[0]}function c(t){return t[1]}function y(t){return t[2]}function f(t,n,i,r){var e=new x(null==n?_:n,null==i?c:i,null==r?y:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?e:e.addAll(t)}function x(t,n,i,r,e,s,h,o,a){this._x=t,this._y=n,this._z=i,this._x0=r,this._y0=e,this._z0=s,this._x1=h,this._y1=o,this._z1=a,this._root=void 0}function z(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}a((function(t,n){for(var i={},r=0;r<t.length;)t[r]in n&&(i[t[r]]=n[t[r]]),r+=1;return i}))(["_x0","_y0","_z0","_x1","_y1","_z1","_root"]);var w=f.prototype=x.prototype;w.copy=function(){var t,n,i=new x(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return i;if(!r.length)return i._root=z(r),i;for(t=[{source:r,target:i._root=new Array(8)}];r=t.pop();)for(var e=0;e<8;++e)(n=r.source[e])&&(n.length?t.push({source:n,target:r.target[e]=new Array(8)}):r.target[e]=z(n));return i},w.add=function(t){var n=+this._x.call(null,t),i=+this._y.call(null,t),r=+this._z.call(null,t);return u(this.cover(n,i,r),n,i,r,t)},w.addAll=function(t){var n,i,r,e,s,h=t.length,o=new Array(h),a=new Array(h),l=new Array(h),_=1/0,c=1/0,y=1/0,f=-1/0,x=-1/0,z=-1/0;for(i=0;i<h;++i)isNaN(r=+this._x.call(null,n=t[i]))||isNaN(e=+this._y.call(null,n))||isNaN(s=+this._z.call(null,n))||(o[i]=r,a[i]=e,l[i]=s,r<_&&(_=r),r>f&&(f=r),e<c&&(c=e),e>x&&(x=e),s<y&&(y=s),s>z&&(z=s));for(f<_&&(_=this._x0,f=this._x1),x<c&&(c=this._y0,x=this._y1),z<y&&(y=this._z0,z=this._z1),this.cover(_,c,y).cover(f,x,z),i=0;i<h;++i)u(this,o[i],a[i],l[i],t[i]);return this},w.cover=function(t,n,i){if(isNaN(t=+t)||isNaN(n=+n)||isNaN(i=+i))return this;var r=this._x0,e=this._y0,s=this._z0,h=this._x1,o=this._y1,a=this._z1;if(isNaN(r))h=(r=Math.floor(t))+1,o=(e=Math.floor(n))+1,a=(s=Math.floor(i))+1;else{if(!(r>t||t>h||e>n||n>o||s>i||i>a))return this;var u,l,_=h-r,c=this._root;switch(l=(i<(s+a)/2)<<2|(n<(e+o)/2)<<1|t<(r+h)/2){case 0:do{(u=new Array(8))[l]=c,c=u}while(o=e+(_*=2),a=s+_,t>(h=r+_)||n>o||i>a);break;case 1:do{(u=new Array(8))[l]=c,c=u}while(o=e+(_*=2),a=s+_,(r=h-_)>t||n>o||i>a);break;case 2:do{(u=new Array(8))[l]=c,c=u}while(e=o-(_*=2),a=s+_,t>(h=r+_)||e>n||i>a);break;case 3:do{(u=new Array(8))[l]=c,c=u}while(e=o-(_*=2),a=s+_,(r=h-_)>t||e>n||i>a);break;case 4:do{(u=new Array(8))[l]=c,c=u}while(o=e+(_*=2),s=a-_,t>(h=r+_)||n>o||s>i);break;case 5:do{(u=new Array(8))[l]=c,c=u}while(o=e+(_*=2),s=a-_,(r=h-_)>t||n>o||s>i);break;case 6:do{(u=new Array(8))[l]=c,c=u}while(e=o-(_*=2),s=a-_,t>(h=r+_)||e>n||s>i);break;case 7:do{(u=new Array(8))[l]=c,c=u}while(e=o-(_*=2),s=a-_,(r=h-_)>t||e>n||s>i)}this._root&&this._root.length&&(this._root=c)}return this._x0=r,this._y0=e,this._z0=s,this._x1=h,this._y1=o,this._z1=a,this},w.data=function(){var t=[];return this.visit((function(n){if(!n.length)do{t.push(n.data)}while(n=n.next)})),t},w.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},w.find=function(t,n,i,r){var e,s,h,o,a,u,_,c,y,f=this._x0,x=this._y0,z=this._z0,w=this._x1,d=this._y1,p=this._z1,v=[],N=this._root;for(N&&v.push(new l(N,f,x,z,w,d,p)),null==r?r=1/0:(f=t-r,x=n-r,z=i-r,w=t+r,d=n+r,p=i+r,r*=r);c=v.pop();)if(!(!(N=c.node)||(s=c.x0)>w||(h=c.y0)>d||(o=c.z0)>p||(a=c.x1)<f||(u=c.y1)<x||(_=c.z1)<z))if(N.length){var g=(s+a)/2,A=(h+u)/2,b=(o+_)/2;v.push(new l(N[7],g,A,b,a,u,_),new l(N[6],s,A,b,g,u,_),new l(N[5],g,h,b,a,A,_),new l(N[4],s,h,b,g,A,_),new l(N[3],g,A,o,a,u,b),new l(N[2],s,A,o,g,u,b),new l(N[1],g,h,o,a,A,b),new l(N[0],s,h,o,g,A,b)),(y=(i>=b)<<2|(n>=A)<<1|t>=g)&&(c=v[v.length-1],v[v.length-1]=v[v.length-1-y],v[v.length-1-y]=c)}else{var m=t-+this._x.call(null,N.data),k=n-+this._y.call(null,N.data),M=i-+this._z.call(null,N.data),P=m*m+k*k+M*M;if(P<r){var j=Math.sqrt(r=P);f=t-j,x=n-j,z=i-j,w=t+j,d=n+j,p=i+j,e=N.data}}return e},w.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t))||isNaN(o=+this._z.call(null,t)))return this;var n,i,r,e,s,h,o,a,u,l,_,c,y,f,x,z=this._root,w=this._x0,d=this._y0,p=this._z0,v=this._x1,N=this._y1,g=this._z1;if(!z)return this;if(z.length)for(;;){if((_=s>=(a=(w+v)/2))?w=a:v=a,(c=h>=(u=(d+N)/2))?d=u:N=u,(y=o>=(l=(p+g)/2))?p=l:g=l,n=z,!(z=z[f=y<<2|c<<1|_]))return this;if(!z.length)break;(n[f+1&7]||n[f+2&7]||n[f+3&7]||n[f+4&7]||n[f+5&7]||n[f+6&7]||n[f+7&7])&&(i=n,x=f)}for(;z.data!==t;)if(r=z,!(z=z.next))return this;return(e=z.next)&&delete z.next,r?(e?r.next=e:delete r.next,this):n?(e?n[f]=e:delete n[f],(z=n[0]||n[1]||n[2]||n[3]||n[4]||n[5]||n[6]||n[7])&&z===(n[7]||n[6]||n[5]||n[4]||n[3]||n[2]||n[1]||n[0])&&!z.length&&(i?i[x]=z:this._root=z),this):(this._root=e,this)},w.removeAll=function(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this},w.root=function(){return this._root},w.size=function(){var t=0;return this.visit((function(n){if(!n.length)do{++t}while(n=n.next)})),t},w.visit=function(t){var n,i,r,e,s,h,o,a,u=[],_=this._root;for(_&&u.push(new l(_,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=u.pop();)if(!t(_=n.node,r=n.x0,e=n.y0,s=n.z0,h=n.x1,o=n.y1,a=n.z1)&&_.length){var c=(r+h)/2,y=(e+o)/2,f=(s+a)/2;(i=_[7])&&u.push(new l(i,c,y,f,h,o,a)),(i=_[6])&&u.push(new l(i,r,y,f,c,o,a)),(i=_[5])&&u.push(new l(i,c,e,f,h,y,a)),(i=_[4])&&u.push(new l(i,r,e,f,c,y,a)),(i=_[3])&&u.push(new l(i,c,y,s,h,o,f)),(i=_[2])&&u.push(new l(i,r,y,s,c,o,f)),(i=_[1])&&u.push(new l(i,c,e,s,h,y,f)),(i=_[0])&&u.push(new l(i,r,e,s,c,y,f))}return this},w.visitAfter=function(t){var n,i=[],r=[];for(this._root&&i.push(new l(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=i.pop();){var e=n.node;if(e.length){var s,h=n.x0,o=n.y0,a=n.z0,u=n.x1,_=n.y1,c=n.z1,y=(h+u)/2,f=(o+_)/2,x=(a+c)/2;(s=e[0])&&i.push(new l(s,h,o,a,y,f,x)),(s=e[1])&&i.push(new l(s,y,o,a,u,f,x)),(s=e[2])&&i.push(new l(s,h,f,a,y,_,x)),(s=e[3])&&i.push(new l(s,y,f,a,u,_,x)),(s=e[4])&&i.push(new l(s,h,o,x,y,f,c)),(s=e[5])&&i.push(new l(s,y,o,x,u,f,c)),(s=e[6])&&i.push(new l(s,h,f,x,y,_,c)),(s=e[7])&&i.push(new l(s,y,f,x,u,_,c))}r.push(n)}for(;n=r.pop();)t(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this},w.x=function(t){return arguments.length?(this._x=t,this):this._x},w.y=function(t){return arguments.length?(this._y=t,this):this._y},w.z=function(t){return arguments.length?(this._z=t,this):this._z};const d=Number.isInteger||function(t){return(0|t)===t},p=a((function(t,n){var i,r;if(null!=n)return d(t)?(r=n)[(i=t)<0?r.length+i:i]:n[t]})),v=t=>{const n=f([],p("x"),p("y"),p("z"));return Object.assign(n,t),n};self.onmessage=({data:t})=>{postMessage((({points:t,eps:n,minPoints:i,tree:r})=>{const e={};for(const h of t){const t=s({point:h,eps:n,tree:r});t.length<i||(e[h.id]={core:h,neighbors:t})}return e})({eps:t.eps,minPoints:t.minPoints,points:t.points,tree:v(t.tree)}),void 0)}})();
//# sourceMappingURL=dbscan-core-finder.js.map